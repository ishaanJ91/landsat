// Load the Landsat 8 Surface Reflectance Image Collection
var longitude = 75;
var latitude = 25;
var targetPoint = ee.Geometry.Point([longitude, latitude]);

var landsatSR = ee.ImageCollection('LANDSAT/LC08/C02/T1_L2')
                  .filterDate('2024-09-01', '2024-09-25') // Broaden date range
                  .filterBounds(targetPoint); // Focus on your area of interest

// Check the number of images available
print('Number of images:', landsatSR.size());

// Get the first image from the collection
var image = landsatSR.first();

// Check if an image was returned
if (image !== null) { // Explicit check for null
  // Convert DN values to Surface Reflectance using the scale factors
  var surfaceReflectance = image.select(['SR_B4', 'SR_B5']) // Select Red (B4) and NIR (B5) bands
                                 .multiply(0.0000275).add(-0.2);

  // Calculate NDVI using the NIR (B5) and Red (B4) bands
  var ndvi = surfaceReflectance.normalizedDifference(['SR_B5', 'SR_B4']).rename('NDVI');

  // Define pixelCount and calculate grid size
  var pixelCount = 5; // Change this value to control the grid size (e.g., 3, 5, 7)
  var pixelSize = 30; // Landsat pixel size is approximately 30 meters
  var halfWindowSize = pixelSize * (pixelCount / 2); // Calculate the half-window size based on pixelCount

  // Define the grid area as a square around the target point
  var grid = targetPoint.buffer(halfWindowSize).bounds();

  // Clip the NDVI image to the grid
  var ndviGrid = ndvi.clip(grid);

  // Visualize the NDVI in the grid using a color gradient
  var ndviPalette = ['#FF0000', '#FFA500', '#FFFF00', '#ADFF2F', '#008000']; // Full color range
  Map.addLayer(ndviGrid, {min: -1, max: 1, palette: ndviPalette}, 'NDVI Grid');

  // Center the map on the grid and adjust the zoom level to see the grid clearly
  Map.centerObject(grid, 16); // Adjust zoom to visualize grid better

  // Extract and display pixel values within the grid
  var pixelValues = ndviGrid.sample({
    region: grid,
    scale: pixelSize,
    geometries: true
  });

  // Print the average NDVI value (force evaluation)
  pixelValues.evaluate(function(result) {
    if (result && result.features.length > 0) {
      // Calculate the sum of NDVI values
      var sumNDVI = result.features.reduce(function(sum, feature) {
        return sum + feature.properties.NDVI;
      }, 0);

      // Calculate the average NDVI value
      var averageNDVI = sumNDVI / result.features.length;

      // Print the average NDVI value
      print('Average NDVI Value in Grid (' + pixelCount + 'x' + pixelCount + '):', averageNDVI);
    } else {
      print('No NDVI pixel values found in the specified grid.');
    }
  });

} else {
  print('No images found for the specified date range and location.');
}

